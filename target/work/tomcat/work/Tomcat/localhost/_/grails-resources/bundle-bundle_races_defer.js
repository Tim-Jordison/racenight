// Generated by CoffeeScript 1.9.3
(function() {
  window.RACENIGHT = window.RACENIGHT || {};

  RACENIGHT.addHorse = function() {
    var raceId;
    raceId = window.raceId;
    console.log("Add horse got called with id" + raceId);
    return $.ajax({
      url: "/race/addHorse?dateTAG=" + new Date().getTime(),
      data: {
        id: raceId
      },
      error: function(jqXHR, textStatus, errorThrown) {
        return console.log('ajax error');
      },
      success: function(data) {
        var race, row, table;
        if (data.success) {
          race = $("#race-" + raceId);
          table = document.getElementById("horse-table-race");
          row = table.insertRow(data.horseNumber - 1);
          return row.innerHTML = data.html;
        }
      }
    });
  };

  $(".add-horse").on("click", function() {
    return RACENIGHT.addHorse();
  });

  $(".set-winner").on("click", function() {
    console.log($(".placement"));
    if (confirm("This will reset the placements for the race. Are you sure you want to continue?")) {
      return $.ajax({
        url: "/race/resetPlacements?dateTAG=" + new Date().getTime(),
        data: {
          raceId: raceId
        },
        error: function(jqXHR, textStatus, errorThrown) {
          return console.log('ajax error');
        },
        success: function(data) {
          var placementNumbers;
          if (data.success) {
            placementNumbers = $(".placement");
            placementNumbers.each(function() {
              $(this)[0].innerHTML = "";
              $(this).parent().find(":checkbox").prop("checked", false);
              return console.log($(this).parent().find(":checkbox"));
            });
            $(".winner-checkbox").removeClass("hidden");
            return window.placedHorses = 0;
          } else {
            return alert("Cannot reset placements because the race results have been locked.");
          }
        }
      });
    }
  });

  $(".winner-checkbox").on("click", function() {
    var horseId, placement;
    horseId = $(this).attr("data-horseid");
    placement = window.placedHorses + 1;
    return $.ajax({
      url: "/race/setHorsePlacement?dateTAG=" + new Date().getTime(),
      data: {
        placement: placement,
        horseId: horseId,
        raceId: window.raceId
      },
      error: function(jqXHR, textStatus, errorThrown) {
        return console.log('ajax error');
      },
      success: function(data) {
        if (data.success) {
          document.getElementById(horseId + "-placement-id").innerHTML = placement;
          $("#" + horseId + "-checkbox").addClass("hidden");
          return window.placedHorses = placement;
        } else {
          return alert("The race results have been locked.");
        }
      }
    });
  });

  $(".lock-race").on("click", function() {
    if (!$(this).hasClass("disabled")) {
      if (confirm("Are you sure you want to lock the results for the race?")) {
        return $.ajax({
          url: "/race/lockResults?dateTAG=" + new Date().getTime(),
          data: {
            raceId: window.raceId
          },
          error: function(jqXHR, textStatus, errorThrown) {
            return console.log('ajax error');
          },
          success: function(data) {
            if (data.success) {
              $(".lock-race").addClass("disabled");
              $(".lock-race")[0].innerHTML = "LOCKED";
              return $(".winner-checkbox").addClass("hidden");
            } else {
              return alert("Failed to lock race.");
            }
          }
        });
      }
    }
  });

}).call(this);


