// Generated by CoffeeScript 1.9.3
(function() {
  var Bet;

  window.RACENIGHT = window.RACENIGHT || {};

  Bet = (function() {
    function Bet(name, raceId, horseId, count, horseName, horseNumber, raceName, tablePosition) {
      this.name = name;
      this.raceId = raceId;
      this.horseId = horseId;
      this.count = count;
      this.horseName = horseName;
      this.horseNumber = horseNumber;
      this.raceName = raceName;
      this.tablePosition = tablePosition;
    }

    return Bet;

  })();

  $(".horse-button").on("click", function() {
    var bet, cells, horseId, horseName, horseNumber, name, previousRow, raceId, raceName, row, rows, table;
    raceId = $(this).attr("data-raceId");
    horseId = $(this).attr("data-horseId");
    horseName = $(this).attr("data-horseName");
    horseNumber = $(this).attr("data-horseNumber");
    raceName = $(this).attr("data-raceName");
    name = raceId + "-" + horseId;
    bet = window.bets[name];
    if (bet) {
      bet.count += 1;
    } else {
      bet = new Bet(name, raceId, horseId, 1, horseName, horseNumber, raceName, window.numberOfBets);
      window.numberOfBets = window.numberOfBets + 1;
    }
    window.bets[name] = bet;
    console.log(window.bets);
    table = document.getElementById("bets-table");
    rows = table.rows;
    if (bet.count > 1) {
      previousRow = rows[bet.tablePosition + 1];
      cells = previousRow.cells;
      cells[0].innerHTML = horseNumber + ": " + horseName + " (" + raceName + ")";
      cells[1].innerHTML = bet.count;
    } else {
      row = table.insertRow(bet.tablePosition + 1);
      row.innerHTML = "<td>" + horseNumber + ": " + horseName + " (" + raceName + ")</td><td>" + bet.count + "</td>";
    }
    console.log("numberOfBets " + numberOfBets);
    if (window.total === 0) {
      console.log("add total");
      window.total = window.total + 1;
      row = table.insertRow(numberOfBets + 1);
      row.innerHTML = "<td>Total</td><td>" + window.total + "</td>";
      return $(".create-ticket").removeClass("hidden");
    } else {
      console.log("total already exists");
      window.total = window.total + 1;
      return rows[window.numberOfBets + 1].cells[1].innerHTML = window.total;
    }
  });

  $(".create-ticket").on("click", function() {
    var ticketUUID;
    if ($(this).hasClass("disabled")) {
      return console.log("easy");
    } else {
      $(this).addClass("disabled");
      $(this).innerHTML = "processing";
      ticketUUID = window.ticketUUID;
      console.log(ticketUUID);
      return $.ajax({
        url: "/ticket/save?dateTAG=" + new Date().getTime(),
        data: {
          bets: JSON.stringify(window.bets),
          ticketUUID: ticketUUID
        },
        error: function(jqXHR, textStatus, errorThrown) {
          return console.log('ajax error');
        },
        success: function(data) {
          if (data.success) {
            console.log("here!!!");
            $(".create-button-div").removeClass("hidden");
            return document.getElementById("ticket-confirm-replacement").innerHTML = data.html;
          }
        }
      });
    }
  });

  $(document).ready(function() {
    window.bets = {};
    window.numberOfBets = 0;
    return window.total = 0;
  });

}).call(this);


